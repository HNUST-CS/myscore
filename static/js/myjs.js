// Generated by CoffeeScript 1.7.1
(function() {
  var dynamicWebService;

  dynamicWebService = '.';

  $(document).ready(function() {
    var checkFailCourse, clear, js, settleFile, waveloop1, waveloop2;
    js = '';
    checkFailCourse = function() {
      return $('#p-score').find('tr').each(function() {
        var content, score;
        content = $(this).find('td').eq(2);
        score = content.text();
        if (score === '不及格' || score === '') {
          content.addClass('danger');
        }
        score = parseInt(score);
        if (score < 60) {
          return content.addClass('danger');
        }
      });
    };
    settleFile = function(js, id) {
      var cnt, i, msg, msg_content, se, semester, t, _ref;
      t = 0;
      cnt = 0;
      $('#id-confirm-btn').attr('data-id', id);
      $('#p-score').append("<tr class='0 1 2 3 4 5 6 7 8'> <th>课程</th> <th>学分</th> <th>成绩</th> </tr>");
      for (i in js) {
        console.log(i);
        msg_content = $('#p-msg').find('tr').eq(1).find('td');
        msg_content.eq(t++).text(js['name']);
        msg_content.eq(t++).text(js['college']);
        msg_content.eq(t++).text(js['major']);
        msg_content.eq(t++).text(js['class']);
        msg_content.eq(t++).text(js['id']);
      }
      _ref = js.detail;
      for (semester in _ref) {
        se = _ref[semester];
        console.log(semester);
        $('#switch').prepend("<button data-tri='" + cnt + "' class='col-xs-6 col-sm-2 btn btn-primary'>" + semester + "</button>");
        for (i in se) {
          msg = se[i];
          console.log(msg.title);
          console.log(msg.score);
          console.log(msg.grade);
          $('#p-score').append("<tr class='" + cnt + "'> <td>" + msg.title + "</td> <td>" + msg.grade + "</td> <td>" + msg.score + "</td> </tr>");
        }
        cnt++;
      }
      $('#p-score tr').not('.' + (cnt - 1)).hide();
      return checkFailCourse();
    };
    clear = function() {
      $('#p-score').empty();
      $('#switch').empty();
      return $('#p-msg').find('tr').eq(1).find('td').empty();
    };
    $('#search-btn').click(function() {
      var number, stat, url;
      number = $('#input1').val();
      if (number === '') {
        $('#input1').addClass('has-error');
        return false;
      }
      $('#input1').removeClass('has-error');
      $('#class_score').attr('disabled', 'disabled');
      clear();
      stat = 0;
      url = dynamicWebService + '/api/score/' + number;
      $.ajax({
        'type': 'GET',
        'url': url,
        'dataType': 'json',
        'success': function(result) {
          settleFile(result, number);
          $('.jumbotron').slideUp();
          $('.score-show-box').fadeIn();
          return $('#class_score').attr('disabled', false);
        },
        'error': function(a, b, c) {
          return $('#input1').addClass('has-error');
        }
      });
      return false;
    });
    $('#id-confirm-btn').click(function() {});
    $('#switch').on('click', '.btn', function() {
      var hsClass;
      hsClass = $(this).attr('data-tri');
      return $('#p-score tr').show().not('.' + hsClass).hide();
    });
    waveloop1 = function() {
      return $("#banner_bolang_bg_1").css({
        "left": "-236px"
      }).animate({
        "left": "-1233px"
      }, 25000, 'linear', waveloop1);
    };
    waveloop2 = function() {
      return $("#banner_bolang_bg_2").css({
        "left": "0px"
      }).animate({
        "left": "-1009px"
      }, 60000, 'linear', waveloop2);
    };
    waveloop1();
    return waveloop2();
  });

}).call(this);
